<?php 

$var='{
  "event_type": "candidate_moved",
  "id": "356a9ec095afe66b1290b2f6fc384cf22a90adf1",
  "fired_at": "2024-05-20T05:44:10Z",
  "resource_type": "candidate",
  "data": {
    "id": "150c662a",
    "name": "MindyTEST YeagerTEST",
    "firstname": "MindyTEST",
    "lastname": "YeagerTEST",
    "headline": null,
    "image_url": null,
    "account": {
      "subdomain": "booknook-inc",
      "name": "BookNook"
    },
    "job": {
      "shortcode": "40359BF110",
      "title": "Online Reading Tutor"
    },
    "stage": "Video Interview",
    "disqualified": false,
    "disqualified_at": null,
    "disqualification_reason": null,
    "hired_at": null,
    "sourced": false,
    "profile_url": "https://booknook-inc.workable.com/backend/jobs/3564366/candidates/353132888",
    "address": "MZ 123, Ojo de Agua, State of Mexico, United Mexican States",
    "phone": null,
    "email": "mindy+test051924@booknook.com",
    "outbound_mailbox": "4eadbveq8qi2@outbound.workablemail.com",
    "domain": "link",
    "uploader_id": null,
    "created_at": "2024-05-20T15:26:15Z",
    "updated_at": "2024-05-20T05:44:10Z",
    "cover_letter": null,
    "summary": null,
    "education_entries": [],
    "experience_entries": [],
    "skills": [],
    "answers": [
      {
        "question": {
          "body": "Do you currently work with or have you every worked with BookNook as an Online Tutor?"
        },
        "answer": {
          "checked": false
        }
      },
      {
        "question": {
          "body": "Some of our contracts with our customers require our tutors to be based in the United States. Are you based in the United States?"
        },
        "answer": {
          "checked": true
        }
      },
      {
        "question": {
          "body": "Please provide your phone number (Please only list the 10 digits - no dashes or parenthesis)"
        },
        "answer": {
          "body": "2102404891"
        }
      },
      {
        "question": {
          "body": "Do you have a U.S. mailing address?"
        },
        "answer": {
          "checked": true
        }
      },
      {
        "question": {
          "body": "Please provide your city of residence."
        },
        "answer": {
          "body": "Boulder"
        }
      },
      {
        "question": {
          "body": "Please provide your state of residence."
        },
        "answer": {
          "body": "CO"
        }
      },
      {
        "question": {
          "body": "Please provide your 5-digit zip code (numbers only)."
        },
        "answer": {
          "body": "80516"
        }
      },
      {
        "question": {
          "body": "Do you reside/work in a state other than California?"
        },
        "answer": {
          "checked": true
        }
      },
      {
        "question": {
          "body": "Are you at least 18 years of age?"
        },
        "answer": {
          "checked": true
        }
      },
      {
        "question": {
          "body": "Do you have a U.S. bank account?"
        },
        "answer": {
          "checked": true
        }
      },
      {
        "question": {
          "body": "All tutoring sessions are fully virtual/remote. BookNook Tutors are required to have a working computer with a microphone, camera, and a strong internet connection. \n\nDo you have access to a working computer with a microphone and camera, and a strong internet connection with a speed of at least 10 mbps?"
        },
        "answer": {
          "checked": true
        }
      },
      {
        "question": {
          "body": "By checking yes, I certify that I understand I will be required to undergo a fingerprint-based background check in order to work with school districts."
        },
        "answer": {
          "checked": true
        }
      },
      {
        "question": {
          "body": "By checking yes, I certify that I meet one of the following qualifications: \n3+ years of teaching experience OR 1+ years of teaching experience AND a Bachelors Degree or higher with K-8 reading."
        },
        "answer": {
          "checked": true
        }
      },
      {
        "question": {
          "body": "What is the highest level of education youve completed?"
        },
        "answer": {
          "choices": [
            {
              "body": "Bachelors"
            }
          ]
        }
      },
      {
        "question": {
          "body": "What types of teaching/tutoring experience have you had? (Check all that apply.)"
        },
        "answer": {
          "choices": [
            {
              "body": "Teaching in a K-12 classroom"
            }
          ]
        }
      },
      {
        "question": {
          "body": "Do you currently have or have you previously had one or more of the following certifications?"
        },
        "answer": {
          "choices": [
            {
              "body": "Currently certified to teach K-12"
            }
          ]
        }
      },
      {
        "question": {
          "body": "If you have any other certifications relevant to this position, please list them here or type N/A."
        },
        "answer": {
          "body": "n/a"
        }
      },
      {
        "question": {
          "body": "How many years of teaching/tutoring experience do you have?"
        },
        "answer": {
          "choices": [
            {
              "body": "5+ years"
            }
          ]
        }
      },
      {
        "question": {
          "body": "Are you currently enrolled in an education degree program?"
        },
        "answer": {
          "checked": false
        }
      },
      {
        "question": {
          "body": "If you are currently enrolled in an education degree program, please list your anticipated graduation date. If you are not, type in N/A."
        },
        "answer": {
          "body": "n/a"
        }
      },
      {
        "question": {
          "body": "What size groups do you have experience teaching/tutoring? (Check all that apply.)"
        },
        "answer": {
          "choices": [
            {
              "body": "1:1"
            },
            {
              "body": "Small groups (up to 6 students)"
            }
          ]
        }
      },
      {
        "question": {
          "body": "Please select the grade levels you wish to tutor. (Please note that BookNook currently serves students in K-8th grade)"
        },
        "answer": {
          "choices": [
            {
              "body": "K-2nd"
            },
            {
              "body": "3rd-5th"
            }
          ]
        }
      },
      {
        "question": {
          "body": "Please indicate any languages (besides English) in which you are fluent and willing to teach native-speaking learners. Check all that apply."
        },
        "answer": {
          "choices": [
            {
              "body": "I am not fluent in any languages other than English"
            }
          ]
        }
      },
      {
        "question": {
          "body": "If you are fluent in a language not referenced above, please indicate here. Otherwise, type in N/A."
        },
        "answer": {
          "body": "n/a"
        }
      },
      {
        "question": {
          "body": "Is there anything else you would like us to know about your experience that you feel is relevant to this position? If not, type in N/A"
        },
        "answer": {
          "body": "n/a"
        }
      },
      {
        "question": {
          "body": "As a part of our hiring process, applicants who pass the application review will be notified via email to complete a one-way video interview. \n\nIf invited, are you willing to complete the one-way interview?\n\nThe interview consists of interview questions and a teaching demonstration. You will have 10 days to complete the interview. It should take about 30 minutes to complete."
        },
        "answer": {
          "checked": true
        }
      }
    ],
    "resume_url": "https://workablehr.s3.amazonaws.com/uploads/628922/3564366/353132888/download/%5BCURRENT%5D%20For%20ADP%20-%20BookNook%2C%20Inc.-BookNook%20Tutoring%20Contract%20%28revised%20April%202022%29.pdf?X-Amz-Expires=60000&X-Amz-Date=20240520T054411Z&X-Amz-Algorithm=AWS4-HMAC-SHA256&X-Amz-Credential=AKIAIR2MIE33PRKXR4CA%2F20240520%2Fus-east-1%2Fs3%2Faws4_request&X-Amz-SignedHeaders=host&X-Amz-Signature=c8a36622be0468f70e62c7e12f27d7b426a471a4ec6f55d0c70c6e95c32992be",
    "tags": [],
    "location": {
      "location_str": "United States",
      "country": "United States",
      "country_code": "US",
      "region": null,
      "region_code": null,
      "city": null,
      "zip_code": null
    },
    "originating_candidate_id": null
  }
}';


  $workableData=json_decode($var,true);
  //var_dump($workableData);

  // echo $workableData['event_type'];
  // echo $workableData['data']['stage'];
//echo $workableData['data']['job']['title'];


$date = new DateTime($source);

//date('m/d/Y h:i:s a',strtotime($workableData['data']['created_at']));

   $AppDate=date('m-d-Y H:i:s',strtotime($workableData['data']['created_at']));
$finaldata['resourceFirstname']=$workableData['data']['firstname'];
$finaldata['resourceLastname']=$workableData['data']['lastname'];
$finaldata['resourceCompanyName']='booknook';
$booknook=$workableData['data']['lastname'];
$finaldata['resourceEmail']=$workableData['data']['email'];
//$finaldata['resourcePassword']=$workableData['data']['phone'];
$finaldata['resourceJobTitle']=$workableData['data']['job']['title'];
$finaldata['recruitingCampaignId']='02D5A8C41962EEA3F01D1C2EF5A2BDE2A01DABC71CE95F015CD013CB617587D9';
$finaldata['resourceAddress1']=$workableData['data']['address']; 
//$finaldata['resourceCity']=$workableData['data']['location']['city']; 
//$finaldata['resourceState']=$workableData['data']['location']['region']; 
$finaldata['resourceCountry']=$workableData['data']['location']['country']; 
//$finaldata['resourceZip']=$workableData['data']['location']['zip_code']; 
//$finaldata['resourcePhone']= $workableData['data']['phone'];






  
 // $PositionType=


  if ($workableData['data']['job']['title']=='Online Math Tutor')
  {
    $resourceJobTitle='Math';
  }
  else
  {
    $resourceJobTitle='Reading';
  }

  
  for ($i=0;$i<count($workableData['data']['answers']);$i++)
  {
    $ques= $workableData['data']['answers'][$i]['question']['body'];

    if (str_contains($ques, 'What is the highest level of education')) { 

        $eduqual=[];
            for ($j=0;$j<count($workableData['data']['answers'][$i]['answer']['choices']);$j++)
            {
                array_push($eduqual,$workableData['data']['answers'][$i]['answer']['choices'][$j]['body']);
            }
        }


        if (str_contains($ques, 'Please provide your phone number')) { 

          $finaldata['resourcePhone']=$workableData['data']['answers'][$i]['answer']['body'];
            
          }
  

          
        if (str_contains($ques, 'Please provide your city of residence')) { 

          $finaldata['resourceCity']=$workableData['data']['answers'][$i]['answer']['body'];
            
          }

          if (str_contains($ques, 'Please provide your state of residence')) { 

            $finaldata['resourceState']=$workableData['data']['answers'][$i]['answer']['body'];
              
            }
            if (str_contains($ques, 'Please provide your 5-digit zip code')) { 

              $finaldata['resourceZip']=$workableData['data']['answers'][$i]['answer']['body'];
                
              }

              
  

        

    if (str_contains($ques, 'How many years of teaching/tutoring experience do you have')) { 

    $yearsexp=[];
        for ($j=0;$j<count($workableData['data']['answers'][$i]['answer']['choices']);$j++)
        {
            array_push($yearsexp,$workableData['data']['answers'][$i]['answer']['choices'][$j]['body']);
        }
    }
        if (str_contains($ques, 'Please select the grade levels you wish to tutor')) { 

            $pref=[];
                for ($j=0;$j<count($workableData['data']['answers'][$i]['answer']['choices']);$j++)
                {
                    array_push($pref,$workableData['data']['answers'][$i]['answer']['choices'][$j]['body']);
                }
    //echo $yearsexp=$workableData['data']['answers'][$i]['answer']['choices'][0]['body'];
 }

 if (str_contains($ques, 'which you are fluent and willing to teach native-speaking learners')) { 

    $languages=[];
        for ($j=0;$j<count($workableData['data']['answers'][$i]['answer']['choices']);$j++)
        {
            array_push($languages,$workableData['data']['answers'][$i]['answer']['choices'][$j]['body']);
        }
//echo $yearsexp=$workableData['data']['answers'][$i]['answer']['choices'][0]['body'];
}

if (str_contains($ques, 'Do you currently have or have you previously had one or more of the following certifications')) { 

    $certifications=[];
        for ($j=0;$j<count($workableData['data']['answers'][$i]['answer']['choices']);$j++)
        {
            array_push($certifications,$workableData['data']['answers'][$i]['answer']['choices'][$j]['body']);
        }
//echo $yearsexp=$workableData['data']['answers'][$i]['answer']['choices'][0]['body'];
}

  }
  

  
  $profileFieldUpdates=array();
  $DegreeLevel['name']='Degree Level';
  $DegreeLevel['values']=$eduqual;

  array_push($profileFieldUpdates,$DegreeLevel);


  if($resourceJobTitle=='Math')
{
 
  $Yrs_of_Exe['name']='Math Yrs of Ex';
  $Yrs_of_Exe['values']=$yearsexp;
}
else{
  
  $Yrs_of_Exe['name']='Read Yrs of Ex';
  $Yrs_of_Exe['values']=$yearsexp;
}


  array_push($profileFieldUpdates,$Yrs_of_Exe);
if($resourceJobTitle=='Math')
{
  $Certs['name']='Math Certs';
  $Certs['values']=$certifications;
}
else{
  $Certs['name']='Read Certs';
  $Certs['values']=$certifications;
}
 

  
  array_push($profileFieldUpdates,$Certs);
  $preference['name']='Preferred grades to teach';
  $preference['values']=$pref;

  array_push($profileFieldUpdates,$preference);


  
  $languagess['name']='Languages Spoken';
  $languagess['values']=$languages;

  array_push($profileFieldUpdates,$languagess);

  $AppDates=[];  
  array_push($AppDates, $AppDate);
  if($resourceJobTitle=='Math')
{
  $dateapp['name']='Math App Date';
  $dateapp['values']=$AppDates;
}
else{
  $dateapp['name']='Reading App Date';
  $dateapp['values']=$AppDates;
}



array_push($profileFieldUpdates,$dateapp);

  $finaldata['profileFieldUpdates']=$profileFieldUpdates;



echo json_encode($finaldata);


// $headers = array(
//   'Accept: application/json',
//   'Content-Type: application/json',
//   'Authorization: Bearer iLbeLZSA43pqP0AV'
// );
// $ch      = curl_init();
// curl_setopt($ch, CURLOPT_URL,'https://booknook.qa.wm.solutions/createAccount/35/149');
// curl_setopt($ch, CURLOPT_HTTPHEADER, $headers);
// curl_setopt($ch, CURLOPT_RETURNTRANSFER, true);
// curl_setopt($ch, CURLOPT_SSL_VERIFYPEER, false);
// curl_setopt($ch, CURLOPT_POSTFIELDS, json_encode($finaldata));
// $register_opt = curl_exec($ch);
// $httpcode     = curl_getinfo($ch, CURLINFO_HTTP_CODE);
// curl_close($ch);

// $result = array(
//   'output' => $register_opt,
//   'httpcode' => $httpcode
// );
// echo json_encode($result);


// $result;